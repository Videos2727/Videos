<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Revision Tutor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --bg-card: #0f172a;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --danger: #fb7185;
      --radius: 14px;
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%, #000 100%);
      color: var(--text);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px 12px;
    }

    .app {
      width: 100%;
      max-width: 1000px;
      background: linear-gradient(135deg,
        rgba(15, 23, 42, 0.98),
        rgba(15, 23, 42, 0.96));
      border-radius: 22px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 20px 20px 22px;
      display: grid;
      grid-template-columns: 1.1fr 1.4fr;
      gap: 18px;
    }

    @media (max-width: 850px) {
      .app {
        grid-template-columns: 1fr;
      }
    }

    header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title span.logo {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background:
        conic-gradient(from 210deg, #38bdf8, #6366f1, #a855f7, #38bdf8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: #0b1120;
      box-shadow: 0 0 18px rgba(56, 189, 248, 0.7);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .badge {
      font-size: 0.75rem;
      padding: 5px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(56, 189, 248, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .panel {
      background: rgba(15, 23, 42, 0.9);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 14px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel h2 {
      font-size: 1rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel h2 span.icon {
      font-size: 1.1rem;
    }

    .panel small {
      color: var(--muted);
      font-size: 0.78rem;
    }

    label {
      font-size: 0.8rem;
      color: var(--muted);
      display: block;
      margin-bottom: 4px;
    }

    select, textarea {
      width: 100%;
      background: #020617;
      border-radius: 999px;
      padding: 7px 10px;
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }

    textarea {
      border-radius: 10px;
      min-height: 80px;
      resize: vertical;
    }

    select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    @media (max-width: 600px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.primary {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #0b1120;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.5);
    }

    button.primary:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.6);
    }

    button.secondary {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    button[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--muted);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.9);
    }

    .question-box, .answer-box {
      background: rgba(2, 6, 23, 0.9);
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 10px;
      font-size: 0.9rem;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
    }

    .question-topic {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .question-text {
      white-space: pre-wrap;
      line-height: 1.4;
    }

    .answer-box {
      max-height: 280px;
      overflow: auto;
      white-space: pre-wrap;
    }

    .muted {
      color: var(--muted);
    }

    .error {
      color: var(--danger);
      font-size: 0.8rem;
    }

    .small {
      font-size: 0.75rem;
    }

    footer {
      grid-column: 1 / -1;
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--muted);
      text-align: center;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">
          <span class="logo">Q</span>
          <span>AI Revision Tutor</span>
        </div>
        <div class="subtitle">
          Students pick a subject & topic ‚Üí get exam-style questions ‚Üí request a full worked solution from AI.
        </div>
      </div>
      <div class="badge">
        Prototype ‚Äì plug into your own AI backend
      </div>
    </header>

    <!-- LEFT: Controls / settings -->
    <section class="panel">
      <h2>
        <span class="icon">üéØ</span>
        <span>Choose subject & topic</span>
      </h2>
      <small>Select what you want to revise, then generate a question.</small>

      <div class="row">
        <div>
          <label for="subjectSelect">Subject</label>
          <select id="subjectSelect"></select>
        </div>
        <div>
          <label for="topicSelect">Topic</label>
          <select id="topicSelect"></select>
        </div>
      </div>

      <div>
        <label for="difficultySelect">Difficulty (for AI explanation style)</label>
        <select id="difficultySelect">
          <option value="basic">Junior / foundation</option>
          <option value="standard" selected>Standard / ATAR</option>
          <option value="extension">Extension / high challenge</option>
        </select>
      </div>

      <div>
        <label for="extraHint">Teacher notes (optional)</label>
        <textarea id="extraHint" placeholder="E.g., 'Use WA ATAR marking style', 'Step-by-step with reasons', 'No calculator method', etc."></textarea>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:4px;">
        <button id="newQuestionBtn" class="primary" type="button">
          <span>Generate question</span> <span>üìö</span>
        </button>
        <button id="nextQuestionBtn" class="secondary" type="button">
          <span>Another question</span>
        </button>
      </div>

      <div class="small muted">
        Questions are stored locally in the browser as a simple bank.
        The AI solution uses the exact text of the selected question.
      </div>
    </section>

    <!-- RIGHT: Question + AI answer -->
    <section class="panel">
      <h2>
        <span class="icon">üß†</span>
        <span>Exam question & AI worked solution</span>
      </h2>

      <div class="question-box" id="questionBox">
        <div class="question-header">
          <div>
            <strong id="questionTitle">No question generated yet</strong>
            <div class="question-topic" id="questionMeta">
              Choose a subject & topic, then click ‚ÄúGenerate question‚Äù.
            </div>
          </div>
          <span class="pill">
            <span class="pill-dot"></span>
            <span id="aiStatusLabel">AI idle</span>
          </span>
        </div>
        <div class="question-text" id="questionText"></div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:6px;">
        <button id="getSolutionBtn" class="primary" type="button" disabled>
          <span>Get AI worked solution</span> <span>‚ú®</span>
        </button>
        <button id="clearSolutionBtn" class="secondary" type="button">
          Clear answer
        </button>
      </div>

      <div class="answer-box" id="answerBox">
        <span class="muted small">
          AI solution will appear here. Ask it to show full working, reasons,
          and marking-style answers.
        </span>
      </div>

      <div id="errorBox" class="error" style="display:none;"></div>

      <div class="small muted">
        <strong>Important:</strong> This page expects an AI backend at
        <code>/api/ai-solution</code>. GitHub Pages is static, so you‚Äôll need:
        <ul class="small">
          <li>a separate server / serverless function that talks to OpenAI (or another AI), and</li>
          <li>to keep your API keys on the server only ‚Äì never inside this file.</li>
        </ul>
      </div>
    </section>

    <footer>
      Made as a template ‚Äì customise the question bank and plug into any AI service.
      You can store questions per syllabus (e.g. WA ATAR, GCSE, IB, etc).
    </footer>
  </div>

  <script>
    /*****************************************************
     * 1. QUESTION BANK
     * ---------------------------------------------------
     * Add / edit subjects, topics, and questions here.
     * Each question can include a "marks" value and an
     * optional "hint" that is sent to the AI.
     *****************************************************/

    const QUESTION_BANK = {
      "Mathematics": {
        "Linear Equations": [
          {
            text: "Solve the equation: 3(2x - 5) = 4x + 7. Show all working.",
            marks: 3
          },
          {
            text: "The perimeter of a rectangle is 42 cm. The length is twice the width. Let the width be w cm.\n\n(a) Write an equation in terms of w.\n(b) Solve your equation to find the width and length.\n(c) Hence, find the area of the rectangle.",
            marks: 5
          }
        ],
        "Simultaneous Equations": [
          {
            text: "Solve the system of equations using any method:\n2x + 3y = 17\n4x - y = 5",
            marks: 4
          },
          {
            text: "Tickets for a concert cost $12 for students and $18 for adults. A total of 120 tickets were sold, raising $1776.\n\n(a) Let s be the number of student tickets and a be the number of adult tickets. Write two simultaneous equations.\n(b) Solve to find s and a.",
            marks: 5
          }
        ],
        "Quadratic Equations": [
          {
            text: "Solve the equation x^2 - 5x + 6 = 0 by factorisation.",
            marks: 3
          },
          {
            text: "A ball is thrown upwards. Its height above the ground after t seconds is given by h(t) = -5t^2 + 20t + 1.\n\n(a) Find the height when t = 1 second.\n(b) Find the time when the ball hits the ground (h = 0). Give your answer correct to 2 decimal places.",
            marks: 5
          }
        ]
      },
      "Physics": {
        "Forces & Motion": [
          {
            text: "A 5.0 kg box is pulled along a horizontal surface with a constant horizontal force of 20 N. The frictional force is 5 N.\n\n(a) Draw a labelled force diagram for the box.\n(b) Calculate the net force acting on the box.\n(c) Calculate the acceleration of the box.",
            marks: 5
          },
          {
            text: "A car accelerates uniformly from rest to a speed of 25 m/s in 10 s.\n\n(a) Calculate the acceleration.\n(b) Calculate the distance travelled in this time.\n(c) Sketch a velocity‚Äìtime graph for the motion.",
            marks: 5
          }
        ],
        "Electricity": [
          {
            text: "A 12 V battery is connected across a resistor of 4.0 Œ©.\n\n(a) Calculate the current in the resistor.\n(b) How much energy is transformed in the resistor in 2.0 minutes?",
            marks: 4
          },
          {
            text: "Two resistors of 3 Œ© and 6 Œ© are connected in series to a 12 V supply.\n\n(a) Calculate the total resistance.\n(b) Calculate the current in the circuit.\n(c) Calculate the voltage across each resistor.",
            marks: 5
          }
        ]
      },
      "Chemistry": {
        "Stoichiometry": [
          {
            text: "Magnesium reacts with hydrochloric acid according to the equation:\nMg(s) + 2HCl(aq) ‚Üí MgCl2(aq) + H2(g)\n\n(a) Calculate the number of moles of Mg in 4.80 g of magnesium.\n(b) Calculate the number of moles of HCl required to react with this amount of Mg.\n(c) Hence, calculate the volume of 0.50 mol/L HCl solution needed.",
            marks: 6
          },
          {
            text: "Nitrogen gas reacts with hydrogen gas to form ammonia according to the balanced equation:\nN2(g) + 3H2(g) ‚Üí 2NH3(g)\n\nIf 10.0 mol of N2 reacts with excess H2:\n(a) How many moles of NH3 can form?\n(b) What mass of NH3 is produced? (M(NH3) = 17.0 g/mol)",
            marks: 4
          }
        ],
        "Acids & Bases": [
          {
            text: "Define the term 'weak acid' and explain how it differs from a strong acid of the same concentration, with reference to ionisation in water and conductivity.",
            marks: 4
          },
          {
            text: "A student titrates 25.0 mL of 0.10 mol/L HCl with a NaOH solution of unknown concentration. The average titre is 18.6 mL.\n\n(a) Write the balanced equation for the reaction.\n(b) Calculate the number of moles of HCl in the flask.\n(c) Calculate the concentration of the NaOH solution.",
            marks: 5
          }
        ]
      }
    };

    /*****************************************************
     * 2. STATE & ELEMENTS
     *****************************************************/

    const subjectSelect = document.getElementById("subjectSelect");
    const topicSelect = document.getElementById("topicSelect");
    const difficultySelect = document.getElementById("difficultySelect");
    const extraHint = document.getElementById("extraHint");

    const newQuestionBtn = document.getElementById("newQuestionBtn");
    const nextQuestionBtn = document.getElementById("nextQuestionBtn");
    const getSolutionBtn = document.getElementById("getSolutionBtn");
    const clearSolutionBtn = document.getElementById("clearSolutionBtn");

    const questionTitle = document.getElementById("questionTitle");
    const questionMeta = document.getElementById("questionMeta");
    const questionTextEl = document.getElementById("questionText");
    const answerBox = document.getElementById("answerBox");
    const errorBox = document.getElementById("errorBox");
    const aiStatusLabel = document.getElementById("aiStatusLabel");

    let currentSubject = null;
    let currentTopic = null;
    let currentQuestion = null;
    let questionIndex = 0;
    let isRequestInProgress = false;

    /*****************************************************
     * 3. INITIALISE DROPDOWNS
     *****************************************************/

    function initDropdowns() {
      const subjects = Object.keys(QUESTION_BANK);
      subjectSelect.innerHTML = subjects
        .map((s, i) => `<option value="${s}" ${i === 0 ? "selected" : ""}>${s}</option>`)
        .join("");

      currentSubject = subjectSelect.value;
      updateTopics();
    }

    function updateTopics() {
      const topics = Object.keys(QUESTION_BANK[currentSubject] || {});
      topicSelect.innerHTML = topics
        .map((t, i) => `<option value="${t}" ${i === 0 ? "selected" : ""}>${t}</option>`)
        .join("");

      currentTopic = topicSelect.value;
      questionIndex = 0;
    }

    /*****************************************************
     * 4. QUESTION SELECTION
     *****************************************************/

    function getNextQuestion() {
      const bank = QUESTION_BANK[currentSubject]?.[currentTopic] || [];
      if (bank.length === 0) {
        currentQuestion = null;
        questionTitle.textContent = "No questions defined for this topic yet.";
        questionMeta.textContent = "Add more items to the QUESTION_BANK in the script.";
        questionTextEl.textContent = "";
        getSolutionBtn.disabled = true;
        return;
      }

      // Simple ‚Äúrotate through the list‚Äù logic
      currentQuestion = bank[questionIndex % bank.length];
      questionIndex++;

      questionTitle.textContent = `${currentSubject} ‚Äì ${currentTopic}`;
      questionMeta.textContent = `Marks: ${currentQuestion.marks ?? "N/A"} | Question ${questionIndex} of ${bank.length}`;
      questionTextEl.textContent = currentQuestion.text;
      getSolutionBtn.disabled = false;
      errorBox.style.display = "none";
      answerBox.textContent = "";
      aiStatusLabel.textContent = "AI idle";
    }

    /*****************************************************
     * 5. AI SOLUTION REQUEST (FRONT-END)
     * ---------------------------------------------------
     * This calls a placeholder backend endpoint `/api/ai-solution`.
     * On GitHub Pages, this will NOT exist ‚Äì you must create it on
     * another service (e.g. Vercel / Cloudflare / your own server)
     * and point the URL below to that.
     *****************************************************/

    async function requestAISolution() {
      if (!currentQuestion || isRequestInProgress) return;

      isRequestInProgress = true;
      getSolutionBtn.disabled = true;
      aiStatusLabel.textContent = "Calling AI‚Ä¶";
      errorBox.style.display = "none";

      const payload = {
        subject: currentSubject,
        topic: currentTopic,
        difficulty: difficultySelect.value,
        questionText: currentQuestion.text,
        marks: currentQuestion.marks,
        teacherNotes: extraHint.value.trim()
      };

      // Show something immediately
      answerBox.textContent =
        "Thinking‚Ä¶ sending the question to your AI backend.\n\n" +
        "If you haven't set that up yet, see the comment in the script near requestAISolution().";

      try {
        /***********************************************
         * OPTION A ‚Äì CALL YOUR OWN BACKEND
         * ---------------------------------
         * Replace `/api/ai-solution` with your server URL.
         * Your server should:
         *   - Accept this JSON payload
         *   - Call OpenAI (or another AI) with a prompt like:
         *       ‚ÄúYou are a helpful teacher. Show full working, marks, and explanations‚Äù
         *   - Return `{ answer: "full worked solution text" }`
         ***********************************************/
        const response = await fetch("/api/ai-solution", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error("Server error: " + response.status);
        }

        const data = await response.json();
        const text = data.answer || "(No 'answer' field returned from backend.)";
        answerBox.textContent = text;
        aiStatusLabel.textContent = "AI answer ready";
      } catch (err) {
        console.error(err);
        answerBox.textContent = "";
        errorBox.textContent =
          "Could not reach the AI backend. On GitHub Pages this is expected until you set up an API.";
        errorBox.style.display = "block";
        aiStatusLabel.textContent = "AI error";
      } finally {
        isRequestInProgress = false;
        getSolutionBtn.disabled = false;
      }
    }

    /*****************************************************
     * 6. OPTIONAL ‚Äì HOW YOUR BACKEND COULD LOOK (OpenAI)
     * ---------------------------------------------------
     * Example Node/Express server pseudocode (NOT run here):
     *
     * import express from "express";
     * import OpenAI from "openai";
     *
     * const app = express();
     * const client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
     *
     * app.use(express.json());
     *
     * app.post("/api/ai-solution", async (req, res) => {
     *   const { subject, topic, difficulty, questionText, marks, teacherNotes } = req.body;
     *
     *   const level =
     *     difficulty === "basic" ? "Explain as to a Year 7/8 student" :
     *     difficulty === "extension" ? "Use high-level reasoning and extension style" :
     *     "Explain clearly for a typical senior student";
     *
     *   const prompt = `
     *   You are an expert teacher. Give a full, step-by-step worked solution
     *   for the following exam-style question. Show all reasoning, formulas,
     *   units, and a short examiner-style final statement.
     *
     *   Subject: ${subject}
     *   Topic: ${topic}
     *   Marks: ${marks ?? "not specified"}
     *   Difficulty: ${difficulty}
     *   Extra teacher notes: ${teacherNotes || "none"}
     *
     *   Question:
     *   ${questionText}
     *
     *   Then, if relevant, give a brief mark breakdown (e.g. 1 mark for correct formula, etc.).
     *   `;
     *
     *   const completion = await client.chat.completions.create({
     *     model: "gpt-4.1-mini",
     *     messages: [
     *       { role: "system", content: level },
     *       { role: "user", content: prompt }
     *     ]
     *   });
     *
     *   const answer = completion.choices[0].message.content;
     *   res.json({ answer });
     * });
     *
     * app.listen(3000);
     *
     *****************************************************/

    /*****************************************************
     * 7. EVENT HANDLERS
     *****************************************************/

    subjectSelect.addEventListener("change", () => {
      currentSubject = subjectSelect.value;
      updateTopics();
    });

    topicSelect.addEventListener("change", () => {
      currentTopic = topicSelect.value;
      questionIndex = 0;
    });

    newQuestionBtn.addEventListener("click", getNextQuestion);
    nextQuestionBtn.addEventListener("click", getNextQuestion);

    getSolutionBtn.addEventListener("click", requestAISolution);

    clearSolutionBtn.addEventListener("click", () => {
      answerBox.textContent = "";
      errorBox.style.display = "none";
      aiStatusLabel.textContent = "AI idle";
    });

    // Kick off
    initDropdowns();
  </script>
</body>
</html>
